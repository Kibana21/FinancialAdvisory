<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Compliance Graph Engine - CompliSense AI</title>

  <link rel="stylesheet" href="styles/aia-theme.css">
  <link rel="stylesheet" href="styles/components.css">
  <style>
    .graph-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: var(--space-xl);
    }

    .graph-canvas {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: var(--space-xl);
      margin-bottom: var(--space-xl);
      position: relative;
      overflow: hidden;
    }

    .graph-svg {
      width: 100%;
      height: 600px;
    }

    .node {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .node:hover {
      transform: scale(1.1);
    }

    .node-circle {
      fill: white;
      stroke-width: 3;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    .node-circle.client { stroke: #3B82F6; }
    .node-circle.agent { stroke: #8B5CF6; }
    .node-circle.product { stroke: #10B981; }
    .node-circle.rule { stroke: #F59E0B; }
    .node-circle.violation { stroke: #EF4444; }

    .node-text {
      font-size: 12px;
      font-weight: 600;
      text-anchor: middle;
      fill: var(--gray-900);
      pointer-events: none;
    }

    .node-label {
      font-size: 10px;
      text-anchor: middle;
      fill: var(--gray-600);
      pointer-events: none;
    }

    .link {
      stroke: var(--gray-300);
      stroke-width: 2;
      fill: none;
    }

    .link.violation {
      stroke: #EF4444;
      stroke-width: 3;
      stroke-dasharray: 5,5;
    }

    .link.compliant {
      stroke: #10B981;
      stroke-width: 2;
    }

    .query-panel {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: var(--space-xl);
      margin-bottom: var(--space-xl);
    }

    .query-input {
      width: 100%;
      padding: var(--space-md);
      border: 2px solid var(--gray-300);
      border-radius: var(--radius-md);
      font-size: var(--font-size-base);
      margin-bottom: var(--space-md);
    }

    .query-input:focus {
      outline: none;
      border-color: var(--aia-red);
    }

    .query-examples {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .query-chip {
      background: var(--gray-100);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: var(--font-size-sm);
      border: 1px solid var(--gray-200);
    }

    .query-chip:hover {
      background: var(--aia-red-light);
      border-color: var(--aia-red);
      color: white;
    }

    .legend {
      display: flex;
      gap: var(--space-xl);
      justify-content: center;
      margin-top: var(--space-lg);
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: var(--font-size-sm);
    }

    .legend-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 3px solid;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .stat-box {
      background: white;
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      text-align: center;
    }

    .stat-value {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      color: var(--aia-red);
    }

    .stat-label {
      font-size: var(--font-size-sm);
      color: var(--gray-600);
      margin-top: 4px;
    }

    .insights-panel {
      background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
      border: 2px solid #C7D2FE;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
    }

    .insights-panel h3 {
      color: #4338CA;
      margin-bottom: var(--space-md);
    }

    .insight-item {
      background: white;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      display: flex;
      align-items: start;
      gap: var(--space-md);
    }

    .insight-icon {
      font-size: 24px;
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <span style="font-size: 28px;">üß†</span>
      <span>CompliSense AI</span>
    </a>
    <ul class="navbar-menu">
      <li><a href="index.html">FHR Form</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
      <li class="nav-dropdown">
        <span class="nav-dropdown-toggle">AI Tools ‚ñæ</span>
        <div class="nav-dropdown-menu">
          <a href="copilot.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">üí¨</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">AI Copilot</div>
              <div class="nav-dropdown-item-desc">Chat compliance assistant</div>
            </div>
          </a>
          <a href="analytics.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">üìà</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Performance Analytics</div>
              <div class="nav-dropdown-item-desc">Track metrics & anomalies</div>
            </div>
          </a>
          <a href="graph.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">üï∏Ô∏è</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Compliance Graph</div>
              <div class="nav-dropdown-item-desc">Visualize relationships</div>
            </div>
          </a>
          <a href="documents.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">üìÑ</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Document Intelligence</div>
              <div class="nav-dropdown-item-desc">OCR & extraction</div>
            </div>
          </a>
          <a href="regulatory.html" class="nav-dropdown-item">
            <span class="nav-dropdown-item-icon">üîî</span>
            <div class="nav-dropdown-item-content">
              <div class="nav-dropdown-item-title">Regulatory Updates</div>
              <div class="nav-dropdown-item-desc">Latest MAS notices</div>
            </div>
          </a>
        </div>
      </li>
      <li><a href="supervisor.html">Supervisor</a></li>
    </ul>
    <div class="navbar-actions">
      <span class="text-gray">Agent: <strong>MAHADEVAN KARTIK</strong></span>
      <span class="badge badge-info">Vitality Bronze</span>
    </div>
  </nav>

  <!-- Graph Container -->
  <div class="graph-container">
    <div style="margin-bottom: var(--space-xl);">
      <h1 style="margin-bottom: var(--space-sm);">üï∏Ô∏è Compliance Graph Engine</h1>
      <p style="color: var(--gray-600); font-size: var(--font-size-lg);">
        Knowledge graph visualization showing relationships between clients, agents, products, and compliance rules
      </p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-value">1,247</div>
        <div class="stat-label">Total Nodes</div>
      </div>
      <div class="stat-box">
        <div class="stat-value">3,892</div>
        <div class="stat-label">Relationships</div>
      </div>
      <div class="stat-box">
        <div class="stat-value">156</div>
        <div class="stat-label">Compliance Rules</div>
      </div>
      <div class="stat-box">
        <div class="stat-value">23</div>
        <div class="stat-label">Violations Found</div>
      </div>
    </div>

    <!-- Query Panel -->
    <div class="query-panel">
      <h3 style="margin-bottom: var(--space-md);">üîç Graph Query Interface</h3>
      <input
        type="text"
        class="query-input"
        id="queryInput"
        placeholder="Enter natural language query (e.g., 'Show all clients aged 55-65 with ILP recommendations')"
      >
      <button class="btn btn-primary" onclick="executeQuery()">Execute Query</button>

      <div style="margin-top: var(--space-lg);">
        <div style="font-size: var(--font-size-sm); color: var(--gray-600); margin-bottom: var(--space-sm);">
          <strong>Try these example queries:</strong>
        </div>
        <div class="query-examples">
          <div class="query-chip" onclick="setQuery('Show my recommendations for clients aged 55-65 in last quarter')">
            üë¥ Senior clients with my recommendations
          </div>
          <div class="query-chip" onclick="setQuery('Which agents repeatedly violate affordability ratios?')">
            ‚ö†Ô∏è Agents with repeated violations
          </div>
          <div class="query-chip" onclick="setQuery('Show clients with premium ratio >35%')">
            üí∞ High premium ratio clients
          </div>
          <div class="query-chip" onclick="setQuery('Which products are most rejected by supervisors?')">
            ‚ùå Most rejected products
          </div>
          <div class="query-chip" onclick="setQuery('Show all ILP recommendations to clients >65 years')">
            üö® Age-inappropriate ILP
          </div>
          <div class="query-chip" onclick="setQuery('Find clients with missing emergency funds')">
            üè¶ Insufficient emergency funds
          </div>
        </div>
      </div>
    </div>

    <!-- Graph Visualization -->
    <div class="graph-canvas">
      <h3 style="margin-bottom: var(--space-lg);">Current View: Agent Pattern Analysis - Last 30 Days</h3>

      <svg class="graph-svg" id="graphSvg">
        <!-- Center Node: Agent -->
        <g class="node" onclick="selectNode('agent1')">
          <circle class="node-circle agent" cx="900" cy="300" r="50"/>
          <text class="node-text" x="900" y="300">Mahadevan</text>
          <text class="node-text" x="900" y="315">Kartik</text>
          <text class="node-label" x="900" y="370">AGENT</text>
        </g>

        <!-- Client Nodes -->
        <g class="node" onclick="selectNode('client1')">
          <line class="link compliant" x1="900" y1="300" x2="600" y2="150"/>
          <circle class="node-circle client" cx="600" cy="150" r="35"/>
          <text class="node-text" x="600" y="150">Tan Wei</text>
          <text class="node-text" x="600" y="163">Ming, 35</text>
          <text class="node-label" x="600" y="200">CLIENT</text>
        </g>

        <g class="node" onclick="selectNode('client2')">
          <line class="link violation" x1="900" y1="300" x2="500" y2="350"/>
          <circle class="node-circle client" cx="500" cy="350" r="35"/>
          <text class="node-text" x="500" y="350">Lim Siew</text>
          <text class="node-text" x="500" y="363">Hong, 68</text>
          <text class="node-label" x="500" y="400">CLIENT</text>
        </g>

        <g class="node" onclick="selectNode('client3')">
          <line class="link compliant" x1="900" y1="300" x2="700" y2="480"/>
          <circle class="node-circle client" cx="700" cy="480" r="35"/>
          <text class="node-text" x="700" y="480">Kumar</text>
          <text class="node-text" x="700" y="493">Rajesh, 42</text>
          <text class="node-label" x="700" y="530">CLIENT</text>
        </g>

        <!-- Product Nodes -->
        <g class="node" onclick="selectNode('product1')">
          <line class="link compliant" x1="600" y1="150" x2="350" y2="100"/>
          <circle class="node-circle product" cx="350" cy="100" r="30"/>
          <text class="node-text" x="350" y="100">Term Life</text>
          <text class="node-label" x="350" y="140">PRODUCT</text>
        </g>

        <g class="node" onclick="selectNode('product2')">
          <line class="link violation" x1="500" y1="350" x2="250" y2="350"/>
          <circle class="node-circle product" cx="250" cy="350" r="30"/>
          <text class="node-text" x="250" y="350">ILP</text>
          <text class="node-label" x="250" y="390">PRODUCT</text>
        </g>

        <g class="node" onclick="selectNode('product3')">
          <line class="link compliant" x1="700" y1="480" x2="450" y2="520"/>
          <circle class="node-circle product" cx="450" cy="520" r="30"/>
          <text class="node-text" x="450" y="520">Whole Life</text>
          <text class="node-label" x="450" y="560">PRODUCT</text>
        </g>

        <!-- Rule Nodes -->
        <g class="node" onclick="selectNode('rule1')">
          <line class="link compliant" x1="350" y1="100" x2="200" y2="50"/>
          <circle class="node-circle rule" cx="200" cy="50" r="25"/>
          <text class="node-text" x="200" y="50" style="font-size: 10px;">Premium</text>
          <text class="node-text" x="200" y="62" style="font-size: 10px;">‚â§15%</text>
          <text class="node-label" x="200" y="85">RULE</text>
        </g>

        <g class="node" onclick="selectNode('rule2')">
          <line class="link violation" x1="250" y1="350" x2="100" y2="300"/>
          <circle class="node-circle violation" cx="100" cy="300" r="25"/>
          <text class="node-text" x="100" y="300" style="font-size: 10px;">Age >65</text>
          <text class="node-text" x="100" y="312" style="font-size: 10px;">No ILP</text>
          <text class="node-label" x="100" y="335">VIOLATION</text>
        </g>

        <g class="node" onclick="selectNode('rule3')">
          <line class="link compliant" x1="450" y1="520" x2="300" y2="570"/>
          <circle class="node-circle rule" cx="300" cy="570" r="25"/>
          <text class="node-text" x="300" y="570" style="font-size: 10px;">Emergency</text>
          <text class="node-text" x="300" y="582" style="font-size: 10px;">‚â•3mo</text>
          <text class="node-label" x="300" y="605">RULE</text>
        </g>

        <!-- Additional Agent Nodes -->
        <g class="node" onclick="selectNode('supervisor')">
          <line class="link" x1="900" y1="300" x2="1200" y2="200"/>
          <circle class="node-circle agent" cx="1200" cy="200" r="40" style="stroke: #8B5CF6; fill: #F3E8FF;"/>
          <text class="node-text" x="1200" y="200">Sarah Chen</text>
          <text class="node-label" x="1200" y="250">SUPERVISOR</text>
        </g>

        <g class="node" onclick="selectNode('peer')">
          <line class="link" x1="900" y1="300" x2="1150" y2="420"/>
          <circle class="node-circle agent" cx="1150" cy="420" r="35"/>
          <text class="node-text" x="1150" y="420">John Tan</text>
          <text class="node-label" x="1150" y="465">PEER AGENT</text>
        </g>
      </svg>

      <!-- Legend -->
      <div class="legend">
        <div class="legend-item">
          <div class="legend-icon" style="border-color: #3B82F6;"></div>
          <span>Client</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="border-color: #8B5CF6;"></div>
          <span>Agent</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="border-color: #10B981;"></div>
          <span>Product</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="border-color: #F59E0B;"></div>
          <span>Rule</span>
        </div>
        <div class="legend-item">
          <div class="legend-icon" style="border-color: #EF4444;"></div>
          <span>Violation</span>
        </div>
        <div class="legend-item">
          <div style="width: 30px; height: 3px; background: #10B981;"></div>
          <span>Compliant</span>
        </div>
        <div class="legend-item">
          <div style="width: 30px; height: 3px; background: #EF4444; border-top: 3px dashed #EF4444;"></div>
          <span>Violation</span>
        </div>
      </div>
    </div>

    <!-- AI Insights -->
    <div class="insights-panel">
      <h3>ü§ñ AI-Detected Patterns & Insights</h3>

      <div class="insight-item">
        <div class="insight-icon">‚ö†Ô∏è</div>
        <div>
          <strong>High-Risk Pattern Detected</strong>
          <p style="margin: 4px 0 0 0; color: var(--gray-700); font-size: var(--font-size-sm);">
            Lim Siew Hong (68 years old) was recommended ILP, violating MAS age-appropriateness guidelines. This is your 2nd similar violation in 30 days.
          </p>
        </div>
      </div>

      <div class="insight-item">
        <div class="insight-icon">üìä</div>
        <div>
          <strong>Agent Performance Comparison</strong>
          <p style="margin: 4px 0 0 0; color: var(--gray-700); font-size: var(--font-size-sm);">
            Your peer John Tan has 96% compliance rate vs your 78%. Common difference: John consistently validates emergency funds before product recommendation.
          </p>
        </div>
      </div>

      <div class="insight-item">
        <div class="insight-icon">üîç</div>
        <div>
          <strong>Lapsed Policy Correlation</strong>
          <p style="margin: 4px 0 0 0; color: var(--gray-700); font-size: var(--font-size-sm);">
            Graph analysis shows 30% of your lapsed policies had premium ratios >35%. Strengthening affordability checks could improve retention by 22%.
          </p>
        </div>
      </div>

      <div class="insight-item">
        <div class="insight-icon">üí°</div>
        <div>
          <strong>Product-Client Mismatch</strong>
          <p style="margin: 4px 0 0 0; color: var(--gray-700); font-size: var(--font-size-sm);">
            Whole Life products recommended to 4 clients aged 35-40 have 85% approval rate. Term Life to same demographic: 98% approval. Consider product mix optimization.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    function setQuery(queryText) {
      document.getElementById('queryInput').value = queryText;
    }

    function executeQuery() {
      const query = document.getElementById('queryInput').value;
      alert(`üîç Executing Graph Query\n\n"${query}"\n\nüìä Results:\n\nIn a full implementation, this would:\n\n‚Ä¢ Parse natural language query using NLP\n‚Ä¢ Convert to Cypher query for Neo4j\n‚Ä¢ Execute graph traversal\n‚Ä¢ Return matching nodes and relationships\n‚Ä¢ Update visualization with results\n‚Ä¢ Generate insights from patterns\n\nExample Output:\n‚úì Found 12 matching clients\n‚úì Identified 3 compliance violations\n‚úì Average premium ratio: 18.2%\n‚úì Recommendation: Review cases #1247, #1289, #1304`);
    }

    function selectNode(nodeId) {
      const nodeData = {
        'agent1': {
          type: 'Agent',
          name: 'Mahadevan Kartik',
          details: 'ID: AIA-SG-0012\nProposals: 47\nApproval Rate: 78%\nCompliance Score: 87/100\nViolations: 2 (last 30 days)'
        },
        'client1': {
          type: 'Client',
          name: 'Tan Wei Ming',
          details: 'Age: 35\nIncome: $4,500/month\nRecommendation: Term Life $650/month\nCompliance: ‚úì All checks passed\nApproval: Pending'
        },
        'client2': {
          type: 'Client',
          name: 'Lim Siew Hong',
          details: 'Age: 68\nIncome: $2,800/month\nRecommendation: ILP $600/month\n‚ö†Ô∏è VIOLATION: ILP not suitable for age 68\nStatus: Rejected by supervisor'
        },
        'product2': {
          type: 'Product',
          name: 'Investment-Linked Policy',
          details: 'Category: Investment\nRisk Level: High\nMin Age: 21\nMax Recommended Age: 65\n‚ö†Ô∏è Age restriction violated in this case'
        },
        'rule2': {
          type: 'Compliance Rule',
          name: 'Age Appropriateness for ILP',
          details: 'Rule ID: MAS-302-ILP-AGE\nDescription: ILP not recommended for clients >65\nSource: MAS Guidelines\nEnforcement: Hard Stop\nViolations (30d): 3 across all agents'
        }
      };

      const data = nodeData[nodeId] || { type: 'Node', name: 'Unknown', details: 'No details available' };

      alert(`üîç Node Details\n\nType: ${data.type}\nName: ${data.name}\n\n${data.details}\n\n[In full implementation, this would show:\n‚Ä¢ Complete relationship map\n‚Ä¢ Historical data\n‚Ä¢ Compliance timeline\n‚Ä¢ Related violations\n‚Ä¢ Recommended actions]`);
    }

    // Animate nodes on load
    window.addEventListener('load', () => {
      const nodes = document.querySelectorAll('.node');
      nodes.forEach((node, index) => {
        node.style.opacity = '0';
        node.style.transform = 'scale(0)';
        setTimeout(() => {
          node.style.transition = 'all 0.5s ease';
          node.style.opacity = '1';
          node.style.transform = 'scale(1)';
        }, index * 100);
      });
    });
  </script>
</body>
</html>
